name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: npm install

      - name: Run Tests
        run: npx vitest --run

      - name: Notify Slack on Failure
        if: failure()
        run: |
          curl -X POST -H 'Content-type: application/json' --data \
          '{"text": "ðŸš¨ Test Step Failed in GitHub Actions for *${{ github.repository }}* on *${{ github.ref }}*"}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}

  build:
    name: Build and Push Docker Image
    runs-on: ubuntu-latest
    needs: test  # Ensures tests pass first

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Build Docker Image
        run: docker build -t my-app .

      - name: Notify Slack on Success
        if: success()
        run: |
          curl -X POST -H 'Content-type: application/json' --data \
          '{"text": "âœ… Build Completed Successfully for *${{ github.repository }}* on *${{ github.ref }}*"}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify Slack on Failure
        if: failure()
        run: |
          curl -X POST -H 'Content-type: application/json' --data \
          '{"text": "ðŸš¨ Build Step Failed in GitHub Actions for *${{ github.repository }}* on *${{ github.ref }}*"}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}
